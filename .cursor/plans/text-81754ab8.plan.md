<!-- 81754ab8-5295-4c05-96fa-ce749c408df3 4e6b8c33-46ce-4ac0-b88a-619ca8902f96 -->
# Cleanup stale shape locks on presence changes

## Goal
When presence updates, scan currently selected shapes. If a shape’s `selectedBy.userId` is not in the current presence map, clear its `selectedBy` both locally and in Firestore.

## Files to change
- `src/components/Canvas/Canvas.tsx` – add an effect that runs on `presenceById` change.

## Edits
- New effect after presence hook:
```200:233:src/components/Canvas/Canvas.tsx
useEffect(() => {
  const presentIds = new Set(Object.keys(presenceById))
  selectedIds.forEach((id) => {
    const s = state.byId[id]
    if (!s) return
    const owner = s.selectedBy?.userId
    if (owner && !presentIds.has(owner)) {
      updateShape(id, { selectedBy: undefined } as any)
      writers.update && writers.update({ ...s, selectedBy: null } as any)
    }
  })
}, [presenceById, selectedIds, state.byId, updateShape, writers])
```

This mirrors existing selection ownership clearing logic, but is triggered by presence changes instead of selection changes.


### To-dos

- [ ] Add effect to clear selectedBy for selected shapes when presence users disappear